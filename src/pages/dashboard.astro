---
import Layout from '../layouts/Layout.astro';
import DashboardCard from '../components/ui/DashboardCard.astro';
import Card from '../components/ui/Card.tsx';
import OrdersByMonthChart from '../components/charts/OrdersByMonthChart.astro';
import SpendByDeptChart from '../components/charts/SpendByDeptChart.astro';
import TopVendorsChart from '../components/charts/TopVendorsChart.astro';
import { checkAuth } from '../utils/auth';

// Protegemos esta ruta para que solo usuarios autenticados puedan verla.
checkAuth(Astro);
---

<Layout title="Dashboard - Sistema de Compras">
  <h1 class="text-3xl font-bold mb-6 text-slate-900">Dashboard</h1>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <DashboardCard
      title="Órdenes Activas" mainValue="12" subLabel="unidades"
      footerLabel="Pendientes de aprobación" accentClass="border-t-blue-500"
      footerActionText="Ver detalle" footerActionLink="#" />
    <DashboardCard
      title="Órdenes Completadas" mainValue="157" subLabel="en el último mes"
      footerLabel="Ciclo finalizado" accentClass="border-t-green-500"
      footerActionText="Ver reporte" footerActionLink="#" />
    <DashboardCard
      title="Proveedores" mainValue="48" subLabel="activos"
      footerLabel="Base de datos maestra" accentClass="border-t-yellow-500"
      footerActionText="Gestionar" footerActionLink="/administracion/proveedores" />
    <DashboardCard
      title="Alertas" mainValue="3" subLabel="críticas"
      footerLabel="Requieren atención inmediata" accentClass="border-t-red-500"
      footerActionText="Revisar" footerActionLink="#" />
  </div>

  <div class="mt-8 space-y-8">
    <Card client:load title="Volumen de Órdenes Mensuales" subtitle="Tendencia de la carga de trabajo en el sistema.">
      <OrdersByMonthChart />
    </Card>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <Card client:load title="Distribución de Gasto por Departamento" subtitle="Proporción del gasto total por unidad solicitante.">
        <SpendByDeptChart />
      </Card>
      <Card client:load title="Top 5 Proveedores por Monto" subtitle="Proveedores con mayor volumen de contratación.">
        <TopVendorsChart />
      </Card>
    </div>
  </div>
</Layout>